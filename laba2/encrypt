from laba2.RC5 import RC5

class Encrypt(RC5):

    # шифрование
    def encrypt(self, data):
        A = int.from_bytes(data[:self.w8], byteorder='little')
        B = int.from_bytes(data[self.w8:], byteorder='little')
        A = (A + self.S[0]) % self.mod
        B = (B + self.S[1]) % self.mod
        for i in range(1, self.R + 1):
            A = (self.__leftshift((A ^ B), B) + self.S[2 * i]) % self.mod
            B = (self.__leftshift((A ^ B), A) + self.S[2 * i + 1]) % self.mod
        return (A.to_bytes(self.w8, byteorder='little')
                + B.to_bytes(self.w8, byteorder='little'))

    # передается имя входного файла и выходного
    def encryptFile(self, inpFileName, outFileName):
        with open(inpFileName, 'rb') as inp, open(outFileName, 'wb') as out:
            run = True
            while run:
                text = inp.read(self.w4)
                if not text:
                    break
                if len(text) != self.w4:
                    # если последняя считанная строка меньше необходимого размера, то  дополняем  нулевыми байтами
                    text = text.ljust(self.w4, b'\x00')
                    run = False
                text = self.encrypt(text)
                out.write(text)

    def encryptBytes(self, data):
        res, run = b'', True
        while run:
            temp = data[:self.w4]
            if len(temp) != self.w4:
                data = data.ljust(self.w4, b'\x00')
                run = False
            res += self.encrypt(temp)
            data = data[self.w4:]
            if not data:
                break
        return res